---
title: "cleaned_code"
authors: "Julia, Kareen, Julia"
date: "April 15, 2018"
output:
  html_document:
    code_folding: hide
---

#### Goal:  
We are trying to classify the trails of Macleish Field station as "Easy", "Medium", or "Hard", depending on their length and elevation data.

```{r, messages = FALSE}
library(sf)
library(dplyr)
# devtools::install_github("beanumber/macleish")
#install.packages("macleish")
library(macleish)
library(tidyverse)
library(leaflet)
```

Find length of each trail, and make sure the crs is correct:
```{r}
trails <- st_as_sf(macleish_layers[["trails"]]) %>% 
  mutate(computed_length = st_length(geometry)) %>%
  group_by(name) %>%
  summarise(length = sum(computed_length))

trails_4326 <- trails %>%
  st_transform(4326)
```

Get contour data: 
```{r}
url <- "http://download.massgis.digital.mass.gov/shapefiles/state/contours250k.zip"
local_file <- basename(url)
download.file(url, destfile = local_file)
unzip(local_file, exdir = "contours")

library(sf)
dsn <- path.expand("contours")

st_layers(dsn)
contours_elevation <- read_sf(dsn)
```

This contour data was retrieved from MassGIS. There is also contour data available in the `macleish` R package. We didn't use the updated package as we already had our code by the time it was included.

Check crs and projections:
```{r}
st_crs(contours_elevation)
contours_4326 <- st_transform(contours_elevation, 4326)
st_crs(contours_4326)
```

Restrict contours to Macleish and plot contour lines with all trails:
```{r}
Boundary_contours[[1]] <- st_intersection(st_as_sf(macleish_layers[["boundary"]]), contours_4326)

leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_layers[["boundary"]])%>%
  addPolylines(data = Boundary_contours) %>%
  addPolylines(data = macleish_layers[["trails"]], color= "brown")
```

Function to make data frame for all trails that calculates the change in elevation:
```{r, warning=FALSE}
#function to take plot all trails
trail_data_fun <- function(data1, trail_name) {
  
  #filter the trail data
  trail_data <- st_as_sf(data1) %>%
    filter(name == trail_name)
    mutate(computed_length = st_length(geometry))
  
  #intersect with contour data
  new_df <- st_intersection(trail_data, Boundary_contours) %>%
    group_by(name) %>%
    summarise(min = min(CONTOUR_FT), max = max(CONTOUR_FT), length = sum(computed_length), change = max-min)

  return(new_df)
}

#these are the trails that actually intersect with the contour data:
trail_int_names <- c("Snowmobile Trail", "Eastern Loop", "Vernal Pool Loop", "Poplar Hill Road", "Western Loop", "Porcupine Trail") 

#try with all trails:
trail_df_list <- lapply(data1 = macleish_layers[["trails"]], trail_int_names, trail_data_fun)

trail_df <- bind_rows(unlist(trail_df_list)) #only resulted in one row, names are gone...

```

From testing to see where the trails intersect with the contour lines, we found that six out of ten trails intersect. We thus didn't include the other three trails (entry trail, Easy Out, Driveway) in finding the intersections, and assume their change in elevation is zero.

Based on the length and change in elevation that we calculated above, we made a new data frame that includes the classification for each trail. Trails were marked as "easy" if they had no change in elevation, and were less than 1,000 meters long. Trails were marked as "hard" if they had a change in elevation greater than 50, or a length longer than 5,000. All other trails were classified as "medium".  

Per this classification system, we have: 

Trail | Change in elevation | length (meters?) | classification
--|--|--|--
Snowmobile Trail | 120 | 6,497 | Hard 
Eastern Loop | 30 | 3,049 | Medium
Vernal Pool Loop | 30 | 721 | Medium
Poplar Hill Road | 60 | 2,700 | Hard
Western Loop | 90 | 4,071 | Hard
Porcupine Trail | 0 | 700 | Easy 
Entry trail | 0 | 208 | Easy
Easy Out | 0 | 136 | Easy
Driveway | 0 | 173 | Easy

**Easy Trail:**  
* x trail

Categorize each trail and plot:
```{r}
trail_names <- c("Porcupine Trail", "Western Loop", "Poplar Hill Road", "Vernal Pool Loop", "Eastern Loop", "entry trail", "Easy Out", "Snowmobile Trail", "Driveway")
classification <- c()

trails_classified <- merge(trail_names, classification)
trails_final <- merge(trails_classified, st_as_sf_macleish_layers[["trails"]])

leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_layers[["boundary"]])%>%
  addPolylines(data = Boundary_contours) %>%
  addPolylines(data = trails_final, color= "brown")
```

