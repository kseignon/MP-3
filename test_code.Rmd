---
title: "Test_code"
author: "Julia Portocarrero"
output: html_document
---
```{r}
library(sf)
library(dplyr)
# devtools::install_github("beanumber/macleish")
#install.packages("macleish")
library(macleish)
library(tidyverse)
library(leaflet)
```

```{r}
test_trail <- st_as_sf(macleish_layers[["trails"]])
#trails2 <- st_set_geometry(macleish_layers[["trails"]], NULL)
```

Using: http://adamwilson.us/RDataScience/04_Spatial_with_sf.html

Try filtering by length
```{r}
trails <- test_trail %>%
  mutate(length = st_length(geometry))
```

#### Work so far on MP#:

```{r}
macleish_layers[["trails"]] %>%
  st_length()
```

```{r}
trails <- st_as_sf(macleish_layers[["trails"]]) %>% #this line is different
  mutate(computed_length = st_length(geometry))
```
```{r}
trails %>% 
group_by(name) %>% 
summarise(Num_segments = n(), 
          total_length = sum(computed_length)) %>%
arrange(total_length)
```
```{r}
trails_4326 <- trails %>%
  st_transform(4326)
trails_4326
```
```{r}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addPolylines(data = trails_4326)
```
```{r}
url <- "http://download.massgis.digital.mass.gov/shapefiles/state/contours250k.zip"
local_file <- basename(url)
download.file(url, destfile = local_file)
unzip(local_file, exdir = "contours")
```
```{r}
library(sf)
dsn <- path.expand("contours")
dsn
list.files(dsn)
```
```{r}
st_layers(dsn)
```
```{r}
contours_elevation <- read_sf(dsn)
contours_elevation
```

```{r}
names (contours_elevation)
```

Check crs and projections...
```{r}
#leaflet() %>%
#  addTiles() %>%
#  addPolylines(data = contours_4326)

st_crs(contours_elevation)
contours_4326 <- st_transform(contours_elevation, 4326)
st_crs(contours_4326)
```

Restrict contours to macleish
```{r}
Boundary_contours[[1]] <- st_intersection(st_as_sf(macleish_layers[["boundary"]]), contours_4326)

leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_layers[["boundary"]])%>%
  addPolylines(data = Boundary_contours) %>%
  addPolylines(data = macleish_layers[["trails"]], color= "brown")
```

Test with just "Porcupine Trail"
```{r}
porcupine <- st_as_sf(macleish_layers[["trails"]]) %>%
  filter(name == "Porcupine Trail") %>%
  #mutate(computed_length = st_length(geometry)) 

leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_layers[["boundary"]])%>%
  addPolylines(data = Boundary_contours) %>%
  addPolylines(data = porcupine, color= "brown")

trail_names <- c("Porcupine Trail", "Western Loop", "Poplar Hill Road", "Vernal Pool Loop", "Eastern Loop", "entry trail", "Easy Out", "Snowmobile Trail", "Driveway")
```

```{r}
#function to take plot all trails
plot_trail_fun <- function(data1, trail_name) {
  table <- st_as_sf(data1) %>%
  filter(name == trail_name)
  
  plot1 <- leaflet() %>%
    addTiles() %>%
    addPolylines(data = macleish_layers[["boundary"]]) %>%
    addPolylines(data = Boundary_contours) %>%
    addPolylines(data = table, color= "brown")
  
  return(plot1)
}

#test function
plot_trail_fun(macleish_layers[["trails"]], "Porcupine Trail")

#try with all trails:
lapply(data1 = macleish_layers[["trails"]], trail_names, plot_trail_fun)

```



Try with colors: Error
```{r}
factpal <- colorFactor((rainbow_hcl(n = 15, c = 50, l = 70, start = 0, end = 360)), trails$name, TRUE)

leaflet() %>%
 addTiles() %>%
 addPolylines(data = macleish_layers[["boundary"]])%>%
 addPolylines(data = Boundary_contours) %>%
 addPolylines(data = macleish_layers[["trails"]], color= ~factpal(name))
```


